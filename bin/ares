#!/usr/bin/env node --harmony
 // process.env.NODE_PATH = __dirname + '/../node_modules/'
const cmd = require('commander')
const chalk = require('chalk')
const message = require('../utils/message')
cmd
    .version('1.1.1')
cmd
    .usage('<command>')
cmd
    .command('init')
    .description('选择模板 初始化项目')
    .alias("i")
    .option("-t, --template <number>", "指定模板编号")
    .action(() => {
        message.info('正在加载模板')
        require('../command/init')()
    })
cmd
    .command('build <path>')
cmd
    .command('plugin')
    .description('选择需要克隆的插件或者组件')
    .alias('p')
    .option("--path <path>", '指定路径')
    .option("--list")
    .action((e) => {
        let type = 'normal';
        let arg = null;
        if (e.list) type = 'list';
        if (e.path) {
            type = 'path';
            arg = e.path;
        }
        require('../command/plugin')(type, arg)
    })
cmd
    .command('d2 <cmd> [arg]')
    .description("D2Admin相关的脚手架命令")
    .option("-c,--complex", "完整的模板")
    .action((type, arg, e) => {
        if (type == 'add') require('../command/D2/add')(arg);
        if (type == 'create') require('../command/D2/create')(arg, e.complex);
        if (type == 'theme') require('../command/D2/theme')();
        if (type == 'install') require('../command/D2/install')(arg);
        if (type == 'list') require('../command/D2/list')();
    })
cmd
    .command('npm')
    .description("npm镜像源切换工具")
    .action(() => {
        require('../command/npm')();
    })
cmd
    .command('node <cmd> [arg]')
    .description("node版本管理工具")
    .action((type, arg) => {
        require('../command/node')(type, arg);
    })
cmd
    .command('weapp <cmd> [arg]')
    .description("微信小程序原生相关的脚手架命令")
    .option("-s,--subpackage <subpackage>",'分包名字')
    .option("-c,--component",'新建->组件')
    .option("-p,--page",'新建->页面')
    .option("--path <path>",'指定路径')
    .action((type,arg,e)=>{
        if(type=='init') require('../command/weapp/init')(arg)
        if(type=='create') require('../command/weapp/create')(arg,e)
        if(type=='plugins') require('../command/weapp/plugins')()
    })
cmd
    .command('ui')
    .description('脚手架的UI视图')
    .action(() => {
        require('../command/ui')()
    })
cmd
    .command('test')
    .action(() => {
        require('../command/test')();

    })
cmd
    .command('*', "无效")
    .action(function (env) {
        console.log(chalk.red('无效命令'));
    });
cmd.parse(process.argv)
if (cmd.template != undefined) {
    console.log(chalk.blue(cmd.template))
}